<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title></title>
    <!-- Link Swiper's CSS -->
    <link rel="stylesheet" href="css/swiper-4.3.3.min.css">
    <meta name = "format-detection" content="telephone = no" />

    <!-- Demo styles -->
    <style>
        html, body {
            position: relative;
            height: 100%;
        }
        body {
            /*background: #eee;*/
            font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
            font-size: 14px;
            color:#000;
            margin: 0;
            padding: 0;
            background: url("img/bj.jpg");
            background-size: 100% 100%;
        }
        .swiper-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            z-index: 2;
        }
        .swiper-slide {
            text-align: center;
            font-size: 18px;
            /*background: #fff;*/

            /* Center slide text vertically */
            display: -webkit-box;
            display: -ms-flexbox;
            display: -webkit-flex;
            display: flex;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            -webkit-justify-content: center;
            justify-content: center;
            -webkit-box-align: center;
            -ms-flex-align: center;
            -webkit-align-items: center;
            align-items: center;
        }
        #head{
            width: 92%;
            overflow: hidden;
            padding-top: 1.5rem;
            margin-left: 4%;
            overflow: hidden;
            height: 5rem;
        }
        #year,#play,#back{
            position: absolute;
            z-index: 10;
        }
        #year{
            /*width: 30%;*/
            left: 10%;
            width: 80%;
            height: 50px;
            text-align: center;
        }
        #year img{
            text-align: center;
            height: 80%;
        }
        #back,#play{
            width: 3rem;
        }
        #play{
            right: 4%;
        }
        .swiper-slide>div{
            width: 80%;
            overflow: hidden;
            height: 70%;
            margin-top: 10%;
        }
        .swiper-slide>div img{
            float: left;
            width: 55%;
            background:url("img/img-border.png")110rem 10rem no-repeat;
            /*border-image: url("img/img-border.png")100% 100% round;*/
        }
        .swiper-slide>div p{
            float: right;
            width: 40%;
            margin-top: 0;
            font-size: 1.4rem;
            line-height: 2rem;
            text-align: justify;
            height: 70%;
            overflow-y: auto;

        }
        @media only screen and (device-width : 375px) and (device-height : 812px) {
            .swiper-slide>div img {
                width: 40%;
            }
            .swiper-slide>div p{
                width: 55%;
            }
        }
        #bj-shade{
            display: block;
            position: absolute;
            z-index: 1;
            background-size: cover;
            background: url("img/two-bj.jpg");
        }

    </style>
</head>
<body>
<div id="bj-shade"></div>
<div id="head">
    <img id="back" src="img/back.png" alt="">
    <div id="year"><img src="" alt=""></div>
    <img id="play" src="img/pause.png" alt="">
</div>
<!-- Swiper -->
<div class="swiper-container">
    <div class="swiper-wrapper">

    </div>
</div>

<!-- Swiper JS -->
<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/swiper-4.3.3.min.js"></script>

<!-- Initialize Swiper -->
<script>
    //js获取url参数
    function GetQueryString(name){
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  unescape(r[2]); return null;
    }
    //定义变量接收url参数，此处的变量名不能与url参数名相同,否则会报错不知道为啥
    var cardId=GetQueryString("resourceId");
    // var cardId="ef9411e8b1821d55f6b759e63e72f711";
    var cardIdAll=[
        ["ef9411e8b1821d55f6b759e681005194","one"],
        ["ef9411e8b1821d55f6b759e668a804d3","two"],
        ["ef9411e8b1821d55f6b759e60ed701df","three"],
        ["ef9411e8b1821d55f6b759e69a829f65","four"],
        ["ef8711e8b1821d55f6b759e6316c13ed","five"],
        ["ef8711e8b1821d55f6b759e64705199e","six"],
        ["ef8e11e8b1821d55f6b759e6bf7d89af","seven"],
        ["ef8e11e8b1821d55f6b759e6f0bd1cc0","eight"],
        ["ef9311e8b1821d55f6b759e6ed785fcd","nine"],
        ["ef9311e8b1821d55f6b759e6fddc8a8e","ten"],
        ["ef8711e8b1821d55f6b759e602a9199c","eleven"],
        ["ef9411e8b1821d55f6b759e62a9a3f00","twelve"],
        ["ef9411e8b1821d55f6b759e64f25b702","thirteen"],
        ["ef9411e8b1821d55f6b759e63e72f711","fourteen"]
    ];
    console.log(cardId);
    var  index;
    $.each(cardIdAll,function(idx){
        if(cardIdAll[idx][0] == cardId){
            index=idx;
            console.log(idx)//idx为数组下标
        }
    });
    console.log(index);

    console.log( cardId.length);
    if( cardId.length==32){
        cardId= cardIdAll[index][1];
    }else{
        cardId=cardId;
    }
    console.log(cardId);
    window.onload=function(){
        if(index){
            swiper.slideTo(index,1);
        }else{
            swiper.slideTo(0,1);
        }

    }
    $("#year img").attr("src","http://www.dadpat.com/app/worldHistory/images/"+cardId+"_title.png");
    // 获取图片内容
    $.ajax({
        type: "post",
        url: "http://www.dadpat.com/file/list.do",
        dataType: "jsonp",
        data:{"path":"app/worldHistory/"+cardId+"/img"},
        async: true,
        success: function (data) {
            var imgList=data.data;
            console.log(imgList);
            // 获取声音
            $.ajax({
                type: "post",
                url: "http://www.dadpat.com/file/list.do",
                dataType: "jsonp",
                data:{"path":"app/worldHistory/"+cardId+"/audio"},
                async: true,
                success: function (data) {
                    var audioList=data.data;
                    console.log(audioList);
                    // 获取文字内容
                    $.ajax({
                        type: "post",
                        url: "http://www.dadpat.com/file/json.do",
                        dataType: "jsonp",
                        data:{"path":"app/worldHistory/"+cardId,"name":cardId},
                        async: true,
                        success: function (data) {
                            var info=data.data.message;
                            console.log(info);
                            for(var i=0,imgPath,audioPath;i<imgList.length;i++){
                                imgPath=imgList[i].split('\\').join('/');
                                audioPath=audioList[i].split('\\').join('/');
                                // $(".swiper-wrapper").append('<div class="swiper-slide" style="background-image:url(http://www.dadpat.com/'+imgPath+')"><img class="videoBtn" src="images/xq_button_stop.png" alt=""><audio class="myVideo" src="http://www.dadpat.com/'+audioPath+'"></audio><p class="myText">'+info[i].text+'</p></div>')
                                $(".swiper-wrapper").append('<div class="swiper-slide" ><div><img src="http://www.dadpat.com/'+imgPath+'" alt=""><p class="myText">'+info[i].text+'</p><audio class="myVideo" src="http://www.dadpat.com/'+audioPath+'"></audio></div></div></div>');
                                console.log("http://www.dadpat.com"+imgPath);
                                console.log(audioPath);
                            }
                        }
                    });
                }
            })

            console.log(data);


        }
    });


</script>
<script>
    window.onload=function(){
        $("#bj-shade").fadeOut();
        // 获取页面所有音频
        var allAudio=$("audio");
        console.log(allAudio);
        var swiper = new Swiper('.swiper-container',{
            lazy:true,
           on:{
               slideChangeTransitionStart: function(){
                   $("#play").attr("src","img/pause.png");
                       if(swiper.isBeginning){
                           allAudio[swiper.activeIndex+1].pause();
                           allAudio[swiper.activeIndex+1].currentTime = 0;
                       }else{
                       }
                       allAudio[swiper.activeIndex-1].pause();
                       allAudio[swiper.activeIndex-1].currentTime = 0;
                       allAudio[swiper.activeIndex+1].pause();
                       allAudio[swiper.activeIndex+1].currentTime = 0;
               },
           }

        });

        $("#play").click(function(){
            var audio=allAudio[swiper.activeIndex];
            if(allAudio[swiper.activeIndex].paused){
                allAudio[swiper.activeIndex].play();
                $("#play").attr("src","img/play.png");
                console.log(audio);
                audio.addEventListener('ended', function () {
                    $("#play").attr("src","img/pause.png");
                }, false);

            }else{
                allAudio[swiper.activeIndex].pause();
                allAudio[swiper.activeIndex].currentTime=0;
                $("#play").attr("src","img/pause.png");
            }
        })
    }
    $("#back").click(function () {
        if(typeof(index) !== "undefined"){
            if(typeof( goofypapaGame ) != "undefined" && goofypapaGame ){
                window.location.href='goofypapa://back';
                return;
            }
        }

        //android ws
        if( typeof(goofyPapa) !== "undefined" ){
            goofyPapa.back();
            return;
        }
        if(history.length) {
            history.go(-1);
            return;
        }
        // if(typeof(index) !== "undefined"){
        //     if( typeof( goofypapaGame ) != "undefined" && goofypapaGame ){
        //         window.location.href='goofypapa://back';
        //     }else{
        //         window.android.exitApp()
        //     }
        // }else{
        //     window.location.href = 'index.html';
        // }
    });
</script>

</body>
</html>
